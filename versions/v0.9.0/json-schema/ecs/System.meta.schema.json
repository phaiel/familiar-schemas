{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://familiar.dev/schemas/ecs/System.meta.schema.json",
  "title": "ECS System Meta-Schema",
  "description": "Schema for defining ECS Systems - Temporal activities / business logic units that read and write entities",
  "type": "object",
  "required": ["title", "x-familiar-kind"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "http://json-schema.org/draft-07/schema#"
    },
    "title": {
      "type": "string",
      "description": "Human-readable name for the system (e.g., FatesGate)"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the system's purpose"
    },
    "x-familiar-kind": {
      "type": "string",
      "const": "system",
      "description": "Must be 'system' for system schemas"
    },
    "x-familiar-input": {
      "type": "object",
      "properties": {
        "$ref": {
          "type": "string",
          "description": "Reference to the input schema for this system"
        }
      },
      "required": ["$ref"],
      "description": "The input type this system accepts"
    },
    "x-familiar-output": {
      "type": "object",
      "properties": {
        "$ref": {
          "type": "string",
          "description": "Reference to the output schema for this system"
        }
      },
      "required": ["$ref"],
      "description": "The output type this system produces"
    },
    "x-familiar-reads": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "$ref": {
            "type": "string",
            "description": "Reference to an entity schema this system reads"
          }
        },
        "required": ["$ref"]
      },
      "description": "List of entity types this system reads from"
    },
    "x-familiar-writes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "$ref": {
            "type": "string",
            "description": "Reference to an entity schema this system writes"
          }
        },
        "required": ["$ref"]
      },
      "description": "List of entity types this system writes to"
    },
    "x-familiar-depends": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "$ref": {
            "type": "string",
            "description": "Reference to a component this system depends on"
          }
        },
        "required": ["$ref"]
      },
      "description": "List of components this system requires"
    },
    "x-familiar-service": {
      "type": "object",
      "properties": {
        "$ref": {
          "type": "string",
          "pattern": "^(\\.\\./)*(nodes/)?[a-z-]+\\.node\\.json$",
          "description": "Reference to the node that runs this system"
        }
      },
      "required": ["$ref"],
      "description": "The node/service this system runs on"
    },
    "x-familiar-queue": {
      "type": "string",
      "description": "Override queue for this system (defaults to node's queue)"
    },
    "x-familiar-timeout": {
      "type": "string",
      "pattern": "^\\d+(s|m|h)$",
      "description": "Activity timeout (e.g., '30s', '5m')"
    },
    "x-familiar-retries": {
      "type": "integer",
      "minimum": 0,
      "default": 3,
      "description": "Number of retry attempts on failure"
    }
  },
  "additionalProperties": true
}




