{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "infra/meta/Environment.meta.schema.json",
  "title": "Infrastructure Environment Meta-Schema",
  "description": "Schema for defining physical infrastructure environments (production, staging, development)",
  "type": "object",
  "required": ["name"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Environment name (production, staging, development)"
    },
    "x-familiar-kind": {
      "const": "environment",
      "description": "Must be 'environment' for environment schemas"
    },
    "nodes": {
      "type": "object",
      "description": "Physical scaling configuration for node types",
      "patternProperties": {
        ".*": {
          "type": "object",
          "properties": {
            "min_replicas": {
              "type": "integer",
              "minimum": 0,
              "description": "Minimum number of instances"
            },
            "max_replicas": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum number of instances"
            },
            "scaling": {
              "type": "object",
              "properties": {
                "metric": {
                  "type": "string",
                  "enum": ["cpu", "memory", "queue_depth", "active_jobs", "custom"],
                  "description": "Scaling metric to monitor"
                },
                "target": {
                  "type": ["number", "integer"],
                  "description": "Target value for scaling (e.g., 80 for 80% CPU)"
                },
                "cooldown": {
                  "type": "string",
                  "pattern": "^\\d+(s|m|h)$",
                  "description": "Cooldown period between scaling actions"
                }
              }
            }
          }
        }
      }
    },
    "global": {
      "type": "object",
      "properties": {
        "version_compatibility": {
          "type": "string",
          "enum": ["exact", "compatible", "latest_compatible"],
          "description": "Schema version compatibility mode"
        },
        "default_timeout": {
          "type": "string",
          "pattern": "^\\d+(s|m|h)$",
          "description": "Default timeout for activities"
        }
      }
    }
  },
  "additionalProperties": true
}
