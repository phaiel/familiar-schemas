{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "ClassifiedPurpose": {
      "description": "A classified purpose with confidence",
      "properties": {
        "confidence": {
          "description": "Confidence score (0.0 to 1.0)",
          "format": "double",
          "type": "number"
        },
        "evidence": {
          "default": [],
          "description": "Evidence/reasoning for classification",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "purpose": {
          "allOf": [
            {
              "$ref": "../primitives/ToolPurpose.schema.json"
            }
          ],
          "description": "The purpose of the message"
        }
      },
      "required": [
        "confidence",
        "purpose"
      ],
      "type": "object"
    },
    "CommandAnalysis": {
      "description": "Analysis of a command purpose",
      "properties": {
        "command_type": {
          "allOf": [
            {
              "$ref": "CommandType.schema.json"
            }
          ],
          "description": "Command type"
        },
        "is_destructive": {
          "description": "Is this command destructive?",
          "type": "boolean"
        },
        "needs_confirmation": {
          "description": "Does this command need confirmation?",
          "type": "boolean"
        },
        "parameters": {
          "additionalProperties": true,
          "default": {},
          "description": "Command parameters",
          "type": "object"
        },
        "target": {
          "default": null,
          "description": "Target of the command",
          "type": [
            "string",
            "null"
          ]
        }
      },
      "required": [
        "command_type",
        "is_destructive",
        "needs_confirmation"
      ],
      "type": "object"
    },
    "CommandType": {
      "description": "Types of commands",
      "oneOf": [
        {
          "description": "Create something",
          "enum": [
            "CREATE"
          ],
          "type": "string"
        },
        {
          "description": "Update/modify",
          "enum": [
            "UPDATE"
          ],
          "type": "string"
        },
        {
          "description": "Delete/remove",
          "enum": [
            "DELETE"
          ],
          "type": "string"
        },
        {
          "description": "Link/connect entities",
          "enum": [
            "LINK"
          ],
          "type": "string"
        },
        {
          "description": "Unlink/disconnect entities",
          "enum": [
            "UNLINK"
          ],
          "type": "string"
        },
        {
          "description": "Export data",
          "enum": [
            "EXPORT"
          ],
          "type": "string"
        },
        {
          "description": "Import data",
          "enum": [
            "IMPORT"
          ],
          "type": "string"
        },
        {
          "description": "Configure settings",
          "enum": [
            "CONFIGURE"
          ],
          "type": "string"
        },
        {
          "description": "Unknown/custom command",
          "enum": [
            "CUSTOM"
          ],
          "type": "string"
        }
      ]
    },
    "FilterOperator": {
      "description": "Filter operators",
      "enum": [
        "equals",
        "not_equals",
        "contains",
        "starts_with",
        "ends_with",
        "greater_than",
        "less_than",
        "between",
        "in",
        "not_in"
      ],
      "type": "string"
    },
    "PurposePipeline": {
      "description": "Processing pipeline category",
      "oneOf": [
        {
          "description": "Memory recording: Segment \u2192 Classify \u2192 Spawn \u2192 Store",
          "enum": [
            "recording"
          ],
          "type": "string"
        },
        {
          "description": "Data retrieval: Parse \u2192 Search \u2192 Format \u2192 Return",
          "enum": [
            "retrieval"
          ],
          "type": "string"
        },
        {
          "description": "Analysis: Parse \u2192 Search \u2192 Analyze \u2192 Synthesize",
          "enum": [
            "analysis"
          ],
          "type": "string"
        },
        {
          "description": "System action: Parse \u2192 Validate \u2192 Execute \u2192 Confirm",
          "enum": [
            "action"
          ],
          "type": "string"
        },
        {
          "description": "Conversation: Respond appropriately",
          "enum": [
            "conversational"
          ],
          "type": "string"
        }
      ]
    },
    "QueryAnalysis": {
      "description": "Analysis of a query purpose",
      "properties": {
        "filters": {
          "default": [],
          "description": "Filters to apply",
          "items": {
            "$ref": "QueryFilter.schema.json"
          },
          "type": "array"
        },
        "query_type": {
          "allOf": [
            {
              "$ref": "../primitives/QueryType.schema.json"
            }
          ],
          "description": "Type of query"
        },
        "search_terms": {
          "description": "Extracted search terms",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "target": {
          "allOf": [
            {
              "$ref": "../primitives/QueryTarget.schema.json"
            }
          ],
          "description": "What the query is targeting"
        }
      },
      "required": [
        "query_type",
        "search_terms",
        "target"
      ],
      "type": "object"
    },
    "QueryFilter": {
      "description": "A filter for queries",
      "properties": {
        "field": {
          "description": "Field to filter on",
          "type": "string"
        },
        "operator": {
          "allOf": [
            {
              "$ref": "FilterOperator.schema.json"
            }
          ],
          "description": "Filter operator"
        },
        "value": {
          "description": "Filter value"
        }
      },
      "required": [
        "field",
        "operator",
        "value"
      ],
      "type": "object"
    }
  },
  "description": "Output from purpose classification",
  "properties": {
    "command_analysis": {
      "anyOf": [
        {
          "$ref": "CommandAnalysis.schema.json"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Command analysis (if purpose is Command)"
    },
    "pipeline": {
      "allOf": [
        {
          "$ref": "PurposePipeline.schema.json"
        }
      ],
      "description": "Recommended processing pipeline"
    },
    "primary": {
      "allOf": [
        {
          "$ref": "ClassifiedPurpose.schema.json"
        }
      ],
      "description": "Primary classified purpose"
    },
    "query_analysis": {
      "anyOf": [
        {
          "$ref": "QueryAnalysis.schema.json"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "description": "Query analysis (if purpose is Query-related)"
    },
    "secondary": {
      "default": [],
      "description": "Secondary purposes (if multi-purpose detected)",
      "items": {
        "$ref": "ClassifiedPurpose.schema.json"
      },
      "type": "array"
    }
  },
  "required": [
    "pipeline",
    "primary"
  ],
  "title": "PurposeClassifierOutput",
  "type": "object",
  "x-familiar-kind": "tool",
  "x-familiar-queue": "worker-queue",
  "x-familiar-role": "output",
  "x-familiar-service": {
    "$ref": "../nodes/familiar-worker.node.json"
  }
}
