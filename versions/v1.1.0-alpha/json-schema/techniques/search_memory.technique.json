{
  "$schema": "../../ecs/Technique.meta.schema.json",
  "$id": "techniques/search_memory.technique.json",
  "id": "search_memory",
  "title": "Search Memory and Context",
  "x-familiar-kind": "technique",

  "input": { "$ref": "../../tools/GateInput.schema.json" },

  "output": { "$ref": "../../entities_api/WeaveUnitResponse.schema.json" },

  "steps": [
    {
      "id": "search_entities",
      "kind": "call",
      "description": "Search for relevant entities in the knowledge base",
      "action": { "$ref": "../actions/entity/search.action.json" },
      "args": {
        "query": "${input.query}",
        "user_id": "${input.user_id}"
      }
    },
    {
      "id": "rank_results",
      "kind": "call",
      "description": "Rank and filter search results by relevance",
      "action": { "$ref": "../actions/entity/rank_search_results.action.json" },
      "args": {
        "results": "${search_entities}",
        "query": "${input.query}"
      }
    }
  ],

  "return": {
    "results": "${rank_results}",
    "total_found": "${search_entities.length}",
    "query": "${input.query}"
  }
}
