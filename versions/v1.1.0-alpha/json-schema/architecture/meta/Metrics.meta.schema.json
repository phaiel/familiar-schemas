{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://familiar.dev/schemas/architecture/meta/Metrics.meta.schema.json",
  "title": "Metrics Meta-Schema",
  "description": "Schema for defining Prometheus metrics and monitoring configuration",
  "type": "object",
  "properties": {
    "enabled": {
      "type": "boolean",
      "default": true,
      "description": "Whether metrics collection is enabled"
    },
    "prometheus_endpoint": {
      "type": "string",
      "default": "/metrics",
      "description": "HTTP endpoint path for Prometheus metrics scraping"
    },
    "collection_interval": {
      "type": "string",
      "pattern": "^\\d+(s|m|h)$",
      "default": "15s",
      "description": "How often to collect and update metrics"
    },
    "metric_definitions": {
      "type": "array",
      "description": "Custom metric definitions for this component",
      "items": {
        "type": "object",
        "required": ["name", "type", "description"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[a-zA-Z_:][a-zA-Z0-9_:]*$",
            "description": "Metric name following Prometheus naming conventions"
          },
          "type": {
            "type": "string",
            "enum": ["counter", "gauge", "histogram", "summary"],
            "description": "Prometheus metric type"
          },
          "description": {
            "type": "string",
            "description": "Human-readable metric description"
          },
          "unit": {
            "type": "string",
            "enum": ["requests", "errors", "latency", "bytes", "operations", "custom"],
            "description": "Unit of measurement"
          },
          "labels": {
            "type": "array",
            "description": "Label names for dimensional metrics",
            "items": {
              "type": "string",
              "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$"
            }
          },
          "buckets": {
            "type": "array",
            "description": "Histogram bucket boundaries (for histogram type only)",
            "items": { "type": "number" }
          }
        }
      }
    },
    "standard_metrics": {
      "type": "object",
      "description": "Enable/disable standard metrics collection",
      "properties": {
        "http_requests_total": { "type": "boolean", "default": true },
        "http_request_duration_seconds": { "type": "boolean", "default": true },
        "errors_total": { "type": "boolean", "default": true },
        "active_connections": { "type": "boolean", "default": true },
        "queue_depth": { "type": "boolean", "default": true },
        "processing_duration_seconds": { "type": "boolean", "default": true },
        "resource_usage": { "type": "boolean", "default": true }
      }
    },
    "histogram_buckets": {
      "type": "object",
      "description": "Default histogram bucket configurations",
      "properties": {
        "duration_seconds": {
          "type": "array",
          "default": [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0, 10.0],
          "items": { "type": "number" }
        },
        "size_bytes": {
          "type": "array",
          "default": [100, 1000, 10000, 100000, 1000000],
          "items": { "type": "number" }
        }
      }
    }
  },
  "additionalProperties": false,
  "x-familiar-kind": "meta",
  "x-familiar-domain": "observability"
}
