{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://familiar.dev/schemas/architecture/Node.meta.schema.json",
  "title": "ECS Node Meta-Schema",
  "description": "Schema for defining ECS Nodes - service definitions that compose Systems and Components (e.g., familiar-daemon, familiar-worker)",
  "type": "object",
  "required": ["id", "x-familiar-kind"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this node type"
    },
    "title": {
      "type": "string",
      "description": "Human-readable name for the node (e.g., FamiliarDaemon)"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the node's purpose"
    },
    "x-familiar-kind": {
      "type": "string",
      "const": "node",
      "description": "Must be 'node' for node schemas"
    },

    "constraints": {
      "type": "object",
      "description": "CEL expressions evaluated at runtime for scheduling decisions",
      "properties": {
        "memory": {
          "type": "string",
          "description": "CEL: node.available_memory > 2Gi"
        },
        "cpu": {
          "type": "string",
          "description": "CEL: node.cpu_usage < 0.8"
        },
        "version": {
          "type": "string",
          "description": "CEL: node.schema_version >= '1.2.0'"
        },
        "health": {
          "type": "string",
          "description": "CEL: node.queue_depth < 100"
        },
        "custom": {
          "type": "string",
          "description": "Application-specific CEL constraints"
        }
      }
    },

    "resources": {
      "type": "object",
      "description": "Resource requirements for infrastructure provisioning",
      "properties": {
        "cpu": {
          "type": "string",
          "description": "CPU allocation (e.g., '2000m' for 2 cores)"
        },
        "memory": {
          "type": "string",
          "description": "Memory allocation (e.g., '8Gi')"
        },
        "storage": {
          "type": "string",
          "description": "Storage allocation (e.g., '100Gi')"
        }
      }
    },

    "systems": {
      "type": "array",
      "description": "Systems this node type executes",
      "items": { "$ref": "../references/SchemaRef.meta.schema.json" }
    }
  },
  "additionalProperties": true,
  "x-familiar-generated": false
}

