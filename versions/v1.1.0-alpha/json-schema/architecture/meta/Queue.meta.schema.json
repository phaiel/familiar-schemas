{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://familiar.dev/schemas/architecture/Queue.meta.schema.json",
  "title": "ECS Queue Meta-Schema",
  "description": "Schema for defining ECS Queues - Temporal task queues or Kafka topics that route work to nodes",
  "type": "object",
  "required": ["title", "x-familiar-kind", "x-familiar-queue-type"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "http://json-schema.org/draft-07/schema#"
    },
    "title": {
      "type": "string",
      "description": "Human-readable name for the queue (e.g., DaemonQueue)"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the queue's purpose"
    },
    "x-familiar-kind": {
      "type": "string",
      "const": "queue",
      "description": "Must be 'queue' for queue schemas"
    },
    "x-familiar-queue-type": {
      "type": "string",
      "enum": ["temporal", "kafka", "redis", "sqs"],
      "description": "The underlying queue technology"
    },
    "x-familiar-resource-class": {
      "type": "string",
      "enum": ["llm", "io", "cpu", "batch"],
      "description": "Resource class for work routed through this queue"
    },
    "x-familiar-concurrency": {
      "type": "integer",
      "minimum": 1,
      "default": 10,
      "description": "Default worker concurrency for this queue"
    },
    "x-familiar-consumers": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "$ref": {
            "type": "string",
            "pattern": "^(\\.\\./)*(nodes/)?[a-z-]+\\.node\\.json$",
            "description": "Reference to a node that consumes from this queue"
          }
        },
        "required": ["$ref"]
      },
      "description": "List of nodes that consume work from this queue"
    },
    "x-familiar-producers": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "$ref": {
            "type": "string",
            "description": "Reference to a system or workflow that produces to this queue"
          }
        },
        "required": ["$ref"]
      },
      "description": "List of systems/workflows that produce work to this queue"
    },
    "x-familiar-dlq": {
      "type": "object",
      "properties": {
        "$ref": {
          "type": "string",
          "description": "Reference to dead letter queue"
        }
      },
      "description": "Dead letter queue for failed messages"
    },
    "x-familiar-retention": {
      "type": "string",
      "pattern": "^\\d+(h|d)$",
      "description": "Message retention period (e.g., '24h', '7d')"
    },
    "x-familiar-visibility-timeout": {
      "type": "string",
      "pattern": "^\\d+(s|m)$",
      "description": "Message visibility timeout"
    }
  },
  "additionalProperties": true,
  "x-familiar-generated": false
}

