{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RoutingContext",
  "description": "The complete world state and telemetry snapshot used by the router for decision making.",
  "x-familiar-kind": "router_context",
  "x-familiar-meta-schema": {
    "$ref": "../meta/Router.meta.schema.json"
  },
  "type": "object",
  "required": ["timestamp", "request", "nodes", "systems", "global_config"],
  "properties": {
    "timestamp": {
      "$ref": "../../primitives/Timestamp.schema.json",
      "description": "When this routing context was captured"
    },

    "request": {
      "description": "The incoming request being routed",
      "type": "object",
      "properties": {
        "id": { "$ref": "../../primitives/UUID.schema.json" },
        "tenant_id": { "$ref": "../../primitives/TenantId.schema.json" },
        "type": { "type": "string", "description": "Request type (weave, search, classify, etc.)" },
        "priority": { "type": "string", "enum": ["low", "normal", "high", "critical"] },
        "payload_size_bytes": { "type": "integer", "minimum": 0 },
        "estimated_complexity": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "user_context": {
          "type": "object",
          "properties": {
            "tier": { "type": "string", "enum": ["free", "premium", "enterprise"] },
            "region": { "type": "string" }
          }
        }
      },
      "required": ["id", "tenant_id", "type"]
    },

    "nodes": {
      "description": "Current state of all available nodes",
      "type": "object",
      "patternProperties": {
        ".*": {
          "type": "object",
          "required": ["id", "status", "capacity"],
          "properties": {
            "id": { "type": "string", "description": "Node identifier" },
            "status": {
              "type": "string",
              "enum": ["healthy", "degraded", "unhealthy", "offline"],
              "description": "Current health status"
            },
            "capacity": {
              "type": "object",
              "description": "Current resource utilization",
              "properties": {
                "cpu_percent": { "type": "number", "minimum": 0.0, "maximum": 100.0 },
                "memory_percent": { "type": "number", "minimum": 0.0, "maximum": 100.0 },
                "gpu_memory_percent": { "type": "number", "minimum": 0.0, "maximum": 100.0 },
                "active_tasks": { "type": "integer", "minimum": 0 },
                "queue_depth": { "type": "integer", "minimum": 0 }
              }
            },
            "specializations": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Node capabilities (gpu, ml, memory-intensive, etc.)"
            },
            "location": {
              "type": "object",
              "properties": {
                "region": { "type": "string" },
                "zone": { "type": "string" }
              }
            }
          }
        }
      }
    },

    "systems": {
      "description": "Current state of all system instances",
      "type": "object",
      "patternProperties": {
        ".*": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "node_id": { "type": "string" },
            "status": { "type": "string", "enum": ["active", "idle", "error", "maintenance"] },
            "performance_metrics": {
              "type": "object",
              "properties": {
                "requests_per_second": { "type": "number", "minimum": 0.0 },
                "average_latency_ms": { "type": "number", "minimum": 0.0 },
                "error_rate": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
                "throughput_bytes_per_second": { "type": "integer", "minimum": 0 }
              }
            }
          }
        }
      }
    },

    "global_config": {
      "description": "Current global configuration snapshot",
      "type": "object",
      "properties": {
        "routing": {
          "type": "object",
          "properties": {
            "default_timeout_ms": { "type": "integer", "minimum": 0 },
            "max_retry_attempts": { "type": "integer", "minimum": 0 },
            "circuit_breaker_threshold": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
          }
        },
        "load_balancing": {
          "type": "object",
          "properties": {
            "strategy": { "type": "string", "enum": ["round_robin", "least_loaded", "weighted_random"] },
            "health_check_interval_ms": { "type": "integer", "minimum": 0 }
          }
        }
      }
    }
  }
}
