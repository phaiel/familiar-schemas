{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Bond",
  "description": "Connection between threads in the cognitive manifold",
  "x-familiar-kind": "entity",
  "allOf": [
    { "$ref": "../architecture/meta/PhysicalEntity.meta.schema.json" }
  ],
  "properties": {
    "bond_strength": {
      "allOf": [
        {
          "$ref": "../primitives/NormalizedFloat.schema.json"
        }
      ],
      "description": "The overall strength or health of the bond. 0.0 = Broken/Weak, 1.0 = Strong/Healthy"
    },
    "damping_coefficient": {
      "description": "The 'inertia' of the bond, representing how quickly it returns to equilibrium. Higher values = slower return to rest (lingering effects). Lower values = quick recovery (resilient).",
      "format": "double",
      "type": "number"
    },
    "formalism": {
      "allOf": [
        {
          "$ref": "../primitives/NormalizedFloat.schema.json"
        }
      ],
      "description": "**Formalism (Transactionalism / Spring Stiffness):** 1.0 = Rigid/Brittle (High k). Hard to move, snaps if stretched. 0.0 = Fluid/Elastic (Low k). Easy to stretch, adapts to change."
    },
    "head_thread_id": {
      "$ref": "../primitives/UUID.schema.json"
    },
    "intimacy": {
      "allOf": [
        {
          "$ref": "../primitives/NormalizedFloat.schema.json"
        }
      ],
      "description": "**Intimacy (Communal Strength / Rest Length):** 1.0 = Fusion (Rest Length 0). The entities want to occupy the same space. 0.0 = Estrangement (Max Rest Length)."
    },
    "metadata": {
      "additionalProperties": {
        "type": "string"
      },
      "type": "object"
    },
    "power_dynamic": {
      "allOf": [
        {
          "$ref": "../primitives/SignedNormalizedFloat.schema.json"
        }
      ],
      "description": "**Power Dynamic (Authority Gradient / Mass Bias):** -1.0 = Target is the Anchor (Infinite Mass relative to Source). 0.0 = Equal Mass (Both move equally). +1.0 = Source is the Anchor."
    },
    "primary_label": {
      "type": [
        "string",
        "null"
      ]
    },
    "spectral_signature": {
      "description": "**Color Filter (Spectral Gating):** If set, this bond only \"lights up\" under specific emotional light. e.g., A \"Work Friend\" bond might only reflect \"Professional\" (Blue) light. Stored as a hex code or vector for the shader.",
      "items": {
        "format": "float",
        "type": "number"
      },
      "maxItems": 3,
      "minItems": 3,
      "type": [
        "array",
        "null"
      ]
    },
    "spring_constant": {
      "description": "The 'stiffness' of the bond, representing its resistance to change. Higher values = more rigid relationship (breaks under stress). Lower values = more flexible relationship (stretches without breaking).",
      "format": "double",
      "type": "number"
    },
    "tail_thread_id": {
      "$ref": "../primitives/UUID.schema.json"
    },
    "text": {
      "type": "string"
    },
    "transparency": {
      "allOf": [
        {
          "$ref": "../primitives/NormalizedFloat.schema.json"
        }
      ],
      "description": "**Transparency (Refractive Index):** 1.0 = Clear. Looking at the Source reveals the Target (e.g., \"Honest\"). 0.0 = Opaque. The relationship hides the Target (e.g., \"Secretive\")."
    }
  },
  "required": [
    "bond_strength",
    "damping_coefficient",
    "formalism",
    "head_thread_id",
    "intimacy",
    "metadata",
    "power_dynamic",
    "spring_constant",
    "tail_thread_id",
    "text",
    "transparency"
  ],
  "type": "object",
  "x-familiar-meta-schema": {
    "$ref": "../architecture/meta/PhysicalEntity.meta.schema.json"
  },
  "x-familiar-persistence": {
    "profile": "timescaledb",
    "hypertable": true,
    "table": "bonds",
    "primary_key": ["id", "t_coord"],
    "partition_column": "t_coord",
    "indexes": [
      "tenant_id",
      "t_coord",
      "head_thread_id",
      "tail_thread_id"
    ]
  },
  "x-familiar-service": {
    "$ref": "../infrastructure/nodes/familiar-daemon.node.json"
  },
  "x-familiar-composition": {
    "physics": [
      "amplitude",
      "energy",
      "position",
      "temperature",
      "velocity"
    ],
    "note": "identity fields kept direct (typed IDs)"
  }
}
