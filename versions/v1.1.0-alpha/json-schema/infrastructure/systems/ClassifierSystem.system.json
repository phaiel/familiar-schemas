{
  "$schema": "../../architecture/meta/System.meta.schema.json",
  "$id": "infrastructure/systems/ClassifierSystem.system.json",
  "id": "classifier-system",
  "title": "Classification System",
  "description": "Main classification dispatch system for incoming requests",
  "x-familiar-kind": "system",
  "dispatch": [
    {
      "trigger": "kafka:classification.requests",
      "technique": { "$ref": "../../techniques/classification/classify-input.technique.json" },
      "routing_policy": "input.urgency == 'high' ? 'gpu-pool' : 'cpu-pool'",
      "constraints": {
        "timeout": "120s",
        "retries": 2,
        "priority": "input.urgency"
      }
    },
    {
      "trigger": "kafka:segment.ready",
      "technique": { "$ref": "../../techniques/classification/entity-only.technique.json" },
      "routing_policy": "'cpu-pool'",
      "constraints": {
        "timeout": "30s",
        "retries": 3
      }
    },
    {
      "trigger": "kafka:purpose.requests",
      "technique": { "$ref": "../../techniques/classification/purpose-only.technique.json" },
      "routing_policy": "'cpu-pool'",
      "constraints": {
        "timeout": "60s",
        "retries": 2
      }
    }
  ],
  "inputs": {
    "classification_request": {
      "schema": { "$ref": "../../primitives/Segment.schema.json" },
      "queue": { "$ref": "../../infrastructure/queues/classifier-queue.queue.json" }
    },
    "segment_request": {
      "schema": { "$ref": "../../primitives/Segment.schema.json" },
      "queue": { "$ref": "../../infrastructure/queues/classifier-queue.queue.json" }
    },
    "batch_request": {
      "schema": {
        "type": "array",
        "items": { "$ref": "../../primitives/Segment.schema.json" }
      },
      "queue": { "$ref": "../../infrastructure/queues/classifier-queue.queue.json" }
    }
  },
  "output": {
    "schema": { "$ref": "../../primitives/SegmentFeatures.schema.json" },
    "queue": { "$ref": "../../infrastructure/queues/classifier-queue.queue.json" }
  },
  "node": {
    "$ref": "../../infrastructure/nodes/classifier.node.json"
  },
  "queue": {
    "$ref": "../../infrastructure/queues/classifier-queue.queue.json"
  }
}
