{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OnboardingEvent",
  "description": "Domain event for onboarding",
  "oneOf": [
    {
      "type": "object",
      "properties": {
        "type": { "const": "user.signup.started" },
        "payload": {
          "type": "object",
          "properties": {
            "email": { "type": "string", "format": "email" },
            "has_invite_code": { "type": "boolean" }
          },
          "required": ["email", "has_invite_code"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "user.signup.completed" },
        "payload": {
          "type": "object",
          "properties": {
            "user_id": { "$ref": "../primitives/UserId.schema.json" },
            "email": { "type": "string", "format": "email" },
            "needs_family": { "type": "boolean" },
            "via_magic_link": { "type": "boolean" }
          },
          "required": ["user_id", "email", "needs_family", "via_magic_link"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "user.magic_link.requested" },
        "payload": {
          "type": "object",
          "properties": {
            "email": { "type": "string", "format": "email" },
            "purpose": { "type": "string" }
          },
          "required": ["email", "purpose"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "user.magic_link.consumed" },
        "payload": {
          "type": "object",
          "properties": {
            "user_id": { "$ref": "../primitives/UserId.schema.json" },
            "email": { "type": "string", "format": "email" },
            "is_new_user": { "type": "boolean" }
          },
          "required": ["user_id", "email", "is_new_user"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "family.created" },
        "payload": {
          "type": "object",
          "properties": {
            "tenant_id": { "$ref": "../primitives/TenantId.schema.json" },
            "tenant_name": { "type": "string" },
            "admin_user_id": { "$ref": "../primitives/UserId.schema.json" }
          },
          "required": ["tenant_id", "tenant_name", "admin_user_id"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "family.member.joined" },
        "payload": {
          "type": "object",
          "properties": {
            "tenant_id": { "$ref": "../primitives/TenantId.schema.json" },
            "user_id": { "$ref": "../primitives/UserId.schema.json" },
            "role": { "type": "string" },
            "via": { "type": "string" }
          },
          "required": ["tenant_id", "user_id", "role", "via"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "family.member.request.submitted" },
        "payload": {
          "type": "object",
          "properties": {
            "tenant_id": { "$ref": "../primitives/TenantId.schema.json" },
            "user_id": { "$ref": "../primitives/UserId.schema.json" },
            "request_id": { "type": "string", "format": "uuid" }
          },
          "required": ["tenant_id", "user_id", "request_id"]
        }
      },
      "required": ["type", "payload"]
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "family.member.request.reviewed" },
        "payload": {
          "type": "object",
          "properties": {
            "tenant_id": { "$ref": "../primitives/TenantId.schema.json" },
            "user_id": { "$ref": "../primitives/UserId.schema.json" },
            "request_id": { "type": "string", "format": "uuid" },
            "approved": { "type": "boolean" },
            "reviewer_id": { "$ref": "../primitives/UserId.schema.json" }
          },
          "required": ["tenant_id", "user_id", "request_id", "approved", "reviewer_id"]
        }
      },
      "required": ["type", "payload"]
    }
  ],
  "x-familiar-kind": "event"
}


